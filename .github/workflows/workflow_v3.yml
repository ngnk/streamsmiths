name: V3 Pipeline

on:
  workflow_dispatch:

  schedule:
    - cron: '0 * * * *'

jobs:
  run-pipeline-v3:
    if: github.ref == 'refs/heads/matt'

    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests python-dotenv polars pyarrow connectorx psycopg2-binary pandas sqlalchemy
      
      - name: Run YouTube Pipeline V3 - Attention 500
        run: python run_pipeline_v3.py
        env:
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
          NEON_DATABASE_URL: ${{ secrets.NEON_DATABASE_URL }}
      
      - name: Pipeline Summary
        if: success()
        run: |
          echo "âœ… V3 Pipeline completed successfully!"
          echo "ðŸŽ¯ Tables updated: channels_log_v3, videos_log_v3, trending_videos_log_v3"
